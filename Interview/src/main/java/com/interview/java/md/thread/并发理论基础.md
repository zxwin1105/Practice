
## 一、CPU架构

现代CPU一般会采用多核模式，每个内核可以独立工作。多核CPU架构图如下：

![CPU架构图](../../../../../../resources/image/CPU架构.png)

 为了均衡内存与CPU之间的速度差异，CPU中设计了多级缓存L1,L2,L3。

### 1.1 CPU多级缓存

- L3缓存：L3缓存容量最大，速度最慢，是多个核心间共享的内存。

- L2缓存：L2缓存容量适中，速度较快，内核独享。

- L1缓存：L1缓存容量最小，速度最快，内核独享。L1缓存内部分为两部分，一部分存储指令单元，一部分存储数据单元。

CPU多级缓存速度大小：寄存器 > L1 > L2 > l3 > 内存

>知识点：缓存是由最小的存储区块--缓存行（cacheLine）组成，缓存行的大小通常为64byte。
> 
>eg: L1缓存大小为512kb，而cacheLine=64byte，则L1有512kb * 1024 / 64个cacheLine。

### 1.2 局部性原理

在CPU访问存储设备时，无论是存取数据还是存储指令，都趋于聚集在一片连续的区域内，被称为局部性原理。

- 时间局部性（Temporal Locality）：如果一个信息项正在被访问，那么在近期很可能还会被再次访问。

- 空间局部性（Spatial Locality）：如果一个存储器的位置被引用，那么将来他附件的位置也会被引用。

## 二、 操作系统内存管理



## 二、为什么需要多线程？

在计算机中，CPU、内存、IO设备的速度是有很大差异的，为了提高CPU的利用率，平衡3者的速度差异，计算机体系结构、操作系统
编译程序都做出了贡献，主要表现为：

- CPU增加了缓存，均衡与内存的速度差异，导致了可见性问题

- 操作系统增加了进程、线程用于分时复用CPU，均衡CPU与IO设备的差异，出现了原子性问题

- 编译程序优化了指令执行次序，使得缓存能够得到更加合理的利用，导致了有序性问题

